https://jboss6.openmaru.io/docs/05.JBossEAP6_Domain_Mode.html

도메인모드는 도메인 컨트롤러와 호스트 컨트롤러, 서버 그룹으로
여러 서버 인스턴스 및 물리적 호스트를 중앙 집중화하여 관리할 수 있다.

도메인 컨트롤러 구성파일은 domain.xml
호스트 컨트롤러 구성파일은 host.xml

도메인은 하나의 도메인 컨트롤러(Domain Controller)
하나 또는 그 이상의 호스트 컨트롤러
서버그룹 이 3가지 멤버로 구성이 됨


원래 JBoss 시작 스크립트를 실행하면 하나의 jboss 인스턴스가 실행되고,
각 인스턴스마다 관리 작업을 수행한다.
만약 스탠드얼론 모드로 여러 개의 독립적인 인스턴스가 시작되어 서버들을 관리해야하는 경우에
관리자는 각각의 인스턴스를 개별적으로 관리할 수 밖에 없다.
예를 들어 전체 서버를 대상으로 애플리케이션을 배포하거나
서버의  설정을 변경하는 경우 관리자가 개별적으로 각 서버에 접속하여 반영해야한다.
즉, 두개의 머신에 있는 4개의 인스턴스를 관리하기 위해서는
각 인스턴스의 관리 콘솔을 통해서 각각 4번 작업을 해주어야 한다.

스탠드얼론 모드에서는 각각의 인스턴스 별도 관리와 서비스를 하게 되지만
도메인 모드에서는 인스턴스는 단독으로 존재하지 않고,호스트 컨트롤러와 세트로 존재하며
호스트 컨트롤러 관리에 의해 운영된다.

작업자는 2개의 머신에서 4개 서버 인스턴스를 관리하기위해
웹 콘솔을 통해 도메인 컨트롤러에 작업을 지시하는 형태로 운영함
이후 도메인컨트롤러가 호스트 컨트롤러를 통해 작업전달.

도메인모드와 관리 기능을 비교하면 스탠드 얼론 모드는 중앙 관리 기능을 사용할 수 없어
부족한 점이 많지만, 서버 인스턴스 구성 방법이 매우 간단하여 사용 사례는 더 많다.
또한 개별 인스턴스에 대해 상세한 제어를 할 수 있기 때문에 스탠드얼론 모드를 선택하는 경우가 많이 있다.


---------------------------------------------------------------------------------------------------------------












host controller는 Domain Controller에서 구성된 정보를 읽어드리고(domain.xml)
domain controller가 장애후 호스트 컨트롤러 구동시에는 구동되지 않음
단 호스트 컨트롤러가 운영중에 도메인 컨트롤러가 장애발생시는 정상작


2. <도메인모드>프로세스 컨트롤러와, 호스트 컨트롤러 
도메인 모드는 여러  서버 인스턴스 및 물리적 호스트를 중앙 집중화하여 관리할 수 있으며
스탠드얼론 모드는 단일 서버 인스턴스 단위로 관리가 가능
-->도메인 모드의 도메인 컨트롤러 프로세스가 전체 도메인을 관리 및 담당
각 머신 상에서 동작하는 호스트 컨트롤러에서 각 서버 인스턴스를 관리

도메인 모드에서 설정,배포,소켓 바인딩,모듈,확장,시스템 속성은 서버 그룹별로 관리

보안 도메인등의 응용 프로그램 보안 설정이 중앙 집중방식으로 단순화 됨

관리 도구에서 서버 그룹에 대한 설정 추가 및 변경은 도메인 컨트롤러에 의해 설정파일(domain.xml)에 저장되고 도메인 내의
호스트 컨트롤러를 통해서 같은 서버 그룹에 속하는 서버에 전달됨.

서버그룹에서는 프로파일이나 애플리케이션 배포 외에도 JVM설정이나 시스템 프로퍼티등을 공유할 수 있다.

각 호스트에서 시작 스크립트를 실행하면 프로세스 컨트롤러가 시작되어 그 자식 프로세스인 호스트 컨트롤러 및 서버 프로세스를 실행한다.
호스트 컨트롤러와 서버 프로세스 간에는 부모,자식 관계는 없다.
프로세스 컨트롤러는 주로 자식 프로세스인 호스트 컨트롤러와 서버 프로세스의 라이프사이클 감시와 시작과 정지를 담당한다.
관리되는(자식프로세스) 호스트 컨트롤러가 어떠한 장애가 의해 정지했을 경우에 프로세스 컨트롤러가 그것을 감지하여 재 시작한다.
도메인 모드에서 호스트상에 도메인 컨트롤러,호스트 컨트롤러,서버 프로세스가 프로세스 컨트롤러가 없는 상태로
가동하는 것은 설계되어 있지 않은 상태. 즉 프로세스 컨트롤러가 동작하지 않는 서버에서는 하위 프로세스들은 동작할 수 없다.

호스트상의 특정 서버에 대한 시작/정지의 오퍼레이션은 도메인 컨트롤러로부터 해당 호스트의 호스트 컨트롤러에 전달되고,
실제로 프로세스 컨트롤러에 의해 시작,정지함.
프로세스 컨트롤러와 호스트 컨트롤러는 서로 소켓으로 통신함.

domain.xml-> 전체 도메인에 공유되는 profile,server-groups,deployments 및 interface,socket-binding-groups의 네임스페이스,네트워크 설정을 관리한다.

host.xml -> 호스트에 공유되는 servers,domain-controller,management를 관리한다.
또,domain.xml에서 정의한 interfaces와 같은 호스트의 명시적인 바인드 주소를 설정하여
subsystem에서 사용하는 포트에 대해서 domain.xml에 설정된 socket-binding-group을 참조한다.

호스트 컨트롤러 시작시 host.xml에만 포함되어 있는 interface등 호스트 고유 설정을 로드한 후 호스트가
도메인의 마스터나 슬레이브 중 무엇인지 domain-controller에서 판단한다.
호스트가 마스터인 경우 domain.xml을 로드한 후 슬레이브의 접속을 기다린다.
호스트가 슬레이브인 경우 마스터에 접속해 domain.xml파일에 관리되는 도메인 전체의 설정을 받는다.
domain.xml, host.xml 두 개의 파일에서 설정 할 수 있는 항목은 
도메인 , 호스트, 서버 그룹과 서버의 여러 컴포넌트에 대해서 설정 가능하다.


<도메인 모드에서의 배포>
도메인 모드에서는 관리도구를 사용해 도메인 컨트롤러를 경유하여 배포한다.
또한 도메인 환경에서는 배포스캐너를 지원하지 않음.
스탠드얼론 모드와는 달리, 서버가아니라 서버그룹을 대상으로 배포하기 때문.
도메인 모드에서의 배포상태는 이럼.


not added<->added<->enabled

not added-> 레파지토리에 애플리케이션이 등록된 상태로 어느 서버 그룹에도 할당되어 있지 않은 상태

added->레파지토리에 애플리케이션이 등록된 상태로 몇 개의 서버 그룹에 할당되어 있지만
사용하지 않도록 설정되어 있기 때문에 애플리케이션에 접근할 수 없는 상태

enabled->레파지토리에 애플리케이션이 등록된 상태로 서버 그룹에 할당되어 사용하고 있는 상태

JBoss의 애플리케이션 배포 방법은 Managed 방식과 Unmanaged 방식이 있다. 또, Archive 방식과 Exploded방식이 있다. 
두 가지 방식이 혼동될 텐데, 이 배포 방법에 대해서 살펴보자.

먼저 archive 방식과 exploded방식의 차이점은 애플리케이션 파일의 구성 방법에 있다.
Archive방식은 압축된 파일을 사용하는 배포방법,
Exploded방식은 애플리케이션의 압축을 풀어놓은 디렉터리를 사용하는 방식.

관리콘솔을 사용해 배포하거ㅏ cli로 배포하면 내부적으로 data디렉터리에 파일을 보관
이렇게 jboss가 앱을 관리하는 경우를 managed방식.
도메인모드에서도 호스트 컨트롤러에 jboss가 내부적으로 복사하고 배포함




































